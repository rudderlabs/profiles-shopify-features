inputs:
  - name: rsIdentifies
    source_metadata:
      role: shopify
      category: webhook
    contract:
      is_optional: false
      is_event_stream: true
      with_entity_ids:
        - user
      with_columns:
        - name: "timestamp"
        - name: user_id
        - name: anonymous_id
        - name: email
    app_defaults:
      # table: RUDDERSTACK_TEST_DB.DATA_APPS_SIMULATED_SHOPIFY.IDENTIFIES
      table: rs_profiles_2.identifies
      occurred_at_col: "timestamp"
      ids:
        - select: "user_id"
          type: user_id
          entity: user
          to_default_stitcher: true
        - select: "anonymous_id"
          type: anonymous_id
          entity: user
          to_default_stitcher: true
        - select: "lower(email)"
          type: email
          entity: user
          to_default_stitcher: true
  - name: rsTracks
    source_metadata:
      role: shopify
      category: webhook
    contract:
      is_optional: false
      is_event_stream: true
      with_entity_ids:
        - user
      with_columns:
        - name: "timestamp"
        - name: user_id
        - name: anonymous_id
    app_defaults:
      # table: RUDDERSTACK_TEST_DB.DATA_APPS_SIMULATED_SHOPIFY.TRACKS
      table: rs_profiles_2.tracks
      occurred_at_col: "timestamp"
      ids:
        - select: "user_id"
          type: user_id
          entity: user
          to_default_stitcher: true
        - select: "anonymous_id"
          type: anonymous_id
          entity: user
          to_default_stitcher: true
  - name: rsPages
    source_metadata:
      role: shopify
      category: webhook
    contract:
      is_optional: false
      is_event_stream: true
      with_entity_ids:
        - user
        - session
      with_columns:
        - name: "timestamp"
        - name: user_id
        - name: anonymous_id
        - name: context_session_id
    app_defaults:
      # table: RUDDERSTACK_TEST_DB.DATA_APPS_SIMULATED_SHOPIFY.PAGES
      table: rs_profiles_2.pages
      occurred_at_col: "timestamp"
      ids:
        - select: "user_id"
          type: user_id
          entity: user
          to_default_stitcher: true
        - select: "anonymous_id"
          type: anonymous_id
          entity: user
          to_default_stitcher: true
        - select: "concat(coalesce(anonymous_id, 'null'), coalesce(to_char(context_session_id, 'FM999999999999999999'), 'null'))"
          type: session_id
          entity: user
          to_default_stitcher: true
        - select: "concat(coalesce(anonymous_id, 'null'), coalesce(to_char(context_session_id, 'FM999999999999999999'), 'null'))"
          type: session_id
          entity: session
          to_default_stitcher: true
  - name: rsOrderCreated
    source_metadata:
      role: shopify
      category: webhook
    contract:
      is_optional: false
      is_event_stream: true
      with_entity_ids:
        - user
      with_columns:
        - name: "timestamp"
        - name: user_id
        - name: anonymous_id
    app_defaults:
      # table: RUDDERSTACK_TEST_DB.DATA_APPS_SIMULATED_SHOPIFY.ORDER_CREATED
      table: rs_profiles_2.order_created
      occurred_at_col: "timestamp"
      ids:
        - select: "user_id"
          type: user_id
          entity: user
          to_default_stitcher: true
        - select: "anonymous_id"
          type: anonymous_id
          entity: user
          to_default_stitcher: true
  - name: rsOrderCancelled
    source_metadata:
      role: shopify
      category: webhook
    contract:
      is_optional: false
      is_event_stream: true
      with_entity_ids:
        - user
      with_columns:
        - name: "timestamp"
        - name: user_id
        - name: anonymous_id
    app_defaults:
      # table: RUDDERSTACK_TEST_DB.DATA_APPS_SIMULATED_SHOPIFY.ORDER_CANCELLED
      table: rs_profiles_2.order_cancelled
      occurred_at_col: "timestamp"
      ids:
        - select: "user_id"
          type: user_id
          entity: user
          to_default_stitcher: true
        - select: "anonymous_id"
          type: anonymous_id
          entity: user
          to_default_stitcher: true
  - name: rsCartUpdate
    source_metadata:
      role: shopify
      category: webhook
    contract:
      is_optional: false
      is_event_stream: true
      with_entity_ids:
        - user
      with_columns:
        - name: "timestamp"
        - name: anonymous_id
    app_defaults:
      # table: RUDDERSTACK_TEST_DB.DATA_APPS_SIMULATED_SHOPIFY.CART_UPDATE
      table: rs_profiles_2.cart_update
      occurred_at_col: "timestamp"
      ids:
        - select: "anonymous_id"
          type: anonymous_id
          entity: user
          to_default_stitcher: true
  - name: rsOrderUpdated
    source_metadata:
      role: shopify
      category: webhook
    contract:
      is_optional: false
      is_event_stream: true
      with_entity_ids:
        - user
      with_columns:
        - name: "timestamp"
        - name: user_id
        - name: anonymous_id
    app_defaults:
      # table: RUDDERSTACK_TEST_DB.DATA_APPS_SIMULATED_SHOPIFY.ORDER_UPDATED
      table: rs_profiles_2.order_updated
      occurred_at_col: "timestamp"
      ids:
        - select: "user_id"
          type: user_id
          entity: user
          to_default_stitcher: true
        - select: "anonymous_id"
          type: anonymous_id
          entity: user
          to_default_stitcher: true
